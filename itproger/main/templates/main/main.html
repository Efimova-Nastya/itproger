{% extends 'main/base.html' %}

{% block content %}
<h1 class="mb-4 fw-bold"> Моя библиотека</h1>
<div class="card search-form mb-4">
    <div class="card-body">
        <form method="get" class="row g-3">
            <div class="col-md-7">
                <label for="q" class="form-label fw-medium">Поиск</label>
                <input type="text" class="form-control" id="q" name="q" value="{{ request.GET.q|default:'' }}" placeholder="Название книги или автор">
            </div>
            <div class="col-md-4">
                <label for="sort" class="form-label fw-medium">Сортировка</label>
                <select class="form-select" id="sort" name="sort">
                    <option value="title" {% if request.GET.sort == 'title' %}selected{% endif %}>Название (А-Я)</option>
                    <option value="-title" {% if request.GET.sort == '-title' %}selected{% endif %}>Название (Я-А)</option>
                    <option value="author__name" {% if request.GET.sort == 'author__name' %}selected{% endif %}>Автор (А-Я)</option>
                    <option value="-author__name" {% if request.GET.sort == '-author__name' %}selected{% endif %}>Автор (Я-А)</option>
                    <option value="publication_date" {% if request.GET.sort == 'publication_date' %}selected{% endif %}>Дата (старые)</option>
                    <option value="-publication_date" {% if request.GET.sort == '-publication_date' %}selected{% endif %}>Дата (новые)</option>
                </select>
            </div>
            <div class="col-md-1 d-flex align-items-end">
                <button type="submit" class="btn btn-primary w-100">
                    <i class="bi bi-search"></i>
                </button>
            </div>
        </form>
    </div>
</div>

{% for book in books %}
<div class="card book-card mb-4">
    <div class="row g-0">
        <div class="col-md-2 d-flex align-items-center justify-content-center p-3">
            {% if book.cover %}
                {% if book.cover_link %}
                    <img src="{{ book.cover.url }}" class="book-cover" alt="{{ book.title }}">
                {% else %}
                    <img src="{{ book.cover.url }}" class="book-cover" alt="{{ book.title }}">
                {% endif %}
            {% else %}
                <div class="bg-light d-flex align-items-center justify-content-center" style="width:100%; height:180px;">
                    <i class="bi bi-book text-muted" style="font-size: 3rem;"></i>
                </div>
            {% endif %}
        </div>
        <div class="col-md-10">
            <div class="card-body d-flex flex-column h-100">
                <h5 class="card-title fw-bold">{{ book.title }}</h5>
                <p class="card-text text-muted">Автор: {{ book.author.name }}</p>

                <div class="mt-auto">
                    <a href="{% url 'book_detail' book.id %}" class="btn btn-outline-primary btn-sm me-2">
                        Подробнее
                    </a>

                </div>
            </div>
        </div>
    </div>
</div>
{% empty %}
<div class="alert alert-light text-center py-5">
    <i class="bi bi-bookmark-x" style="font-size: 3rem; color: #adb5bd;"></i>
    <p class="mt-3 mb-0">Книги не найдены. Попробуйте изменить запрос.</p>
</div>
{% endfor %}
{% endblock %}